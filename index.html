<!DOCTYPE html>
<html>
<head>
<style>
  body { background-color: #f0f4f8; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: sans-serif; }
  
  #puzzle-svg { width: 500px; height: 500px; background: white; border-radius: 20px; shadow: 0 10px 25px rgba(0,0,0,0.1); }

  /* Estilo de los huecos (slots) */
  .slot { fill: #e2e8f0; stroke: #cbd5e1; stroke-width: 2; stroke-dasharray: 4; }

  /* Estilo de las piezas */
  .piece { cursor: grab; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); transition: transform 0.1s; }
  .piece:active { cursor: grabbing; }
  
  /* Colores para las provincias */
  [data-province="a_coruna"] { fill: #60a5fa; }
  [data-province="lugo"]     { fill: #34d399; }
  [data-province="ourense"]  { fill: #fbbf24; }
  [data-province="pontevedra"] { fill: #f87171; }

  /* Etiquetas de texto */
  text { pointer-events: none; font-weight: bold; font-size: 12px; fill: #1e293b; text-anchor: middle; }
</style>
</head>
<body>

<svg id="puzzle-svg" viewBox="0 0 400 400">
  <!-- TABLERO / HUECOS -->
  <g id="board">
    <rect class="slot" data-province="a_coruna" x="100" y="80" width="80" height="80" />
    <rect class="slot" data-province="lugo" x="200" y="80" width="80" height="80" />
    <rect class="slot" data-province="ourense" x="100" y="180" width="80" height="80" />
    <rect class="slot" data-province="pontevedra" x="200" y="180" width="80" height="80" />
  </g>

  <!-- PIEZAS MÓVILES -->
  <g id="pieces">
    <g class="draggable" data-province="a_coruna">
      <rect class="piece" x="20" y="80" width="80" height="80" rx="10" />
      <text x="60" y="125">A Coruña</text>
    </g>
    
    <g class="draggable" data-province="lugo">
      <rect class="piece" x="20" y="180" width="80" height="80" rx="10" />
      <text x="60" y="225">Lugo</text>
    </g>

    <g class="draggable" data-province="ourense">
      <rect class="piece" x="300" y="80" width="80" height="80" rx="10" />
      <text x="340" y="125">Ourense</text>
    </g>

    <g class="draggable" data-province="pontevedra">
      <rect class="piece" x="300" y="180" width="80" height="80" rx="10" />
      <text x="340" y="225">Pontevedra</text>
    </g>
  </g>
</svg>

<script>
  const svg = document.getElementById('puzzle-svg');
  let selectedElement = null;
  let offset = { x: 0, y: 0 };

  // Obtener coordenadas del ratón relativas al SVG
  function getMousePos(evt) {
    const CTM = svg.getScreenCTM();
    return {
      x: (evt.clientX - CTM.e) / CTM.a,
      y: (evt.clientY - CTM.f) / CTM.d
    };
  }

  svg.addEventListener('mousedown', (evt) => {
    const target = evt.target.closest('.draggable');
    if (target) {
      selectedElement = target;
      const mousePos = getMousePos(evt);
      
      // Calcular la diferencia entre el ratón y el origen del grupo
      const transform = selectedElement.getAttribute('transform') || 'translate(0,0)';
      const match = /translate\(([^,]+),([^)]+)\)/.exec(transform);
      const tx = match ? parseFloat(match[1]) : 0;
      const ty = match ? parseFloat(match[2]) : 0;
      
      offset.x = mousePos.x - tx;
      offset.y = mousePos.y - ty;
      
      // Poner la pieza encima de todas
      svg.getElementById('pieces').appendChild(selectedElement);
    }
  });

  window.addEventListener('mousemove', (evt) => {
    if (selectedElement) {
      const mousePos = getMousePos(evt);
      const x = mousePos.x - offset.x;
      const y = mousePos.y - offset.y;
      selectedElement.setAttribute('transform', `translate(${x}, ${y})`);
    }
  });

  window.addEventListener('mouseup', (evt) => {
    if (selectedElement) {
      const province = selectedElement.getAttribute('data-province');
      const slot = svg.querySelector(`.slot[data-province="${province}"]`);
      
      const mousePos = getMousePos(evt);
      const slotX = parseFloat(slot.getAttribute('x'));
      const slotY = parseFloat(slot.getAttribute('y'));
      
      // Coordenadas actuales de la pieza (Origen inicial + traslación)
      const rect = selectedElement.querySelector('.piece');
      const currentX = parseFloat(rect.getAttribute('x')) + (mousePos.x - offset.x);
      const currentY = parseFloat(rect.getAttribute('y')) + (mousePos.y - offset.y);

      // Si está cerca del hueco (margen de 30px), encajar
      if (Math.abs(currentX - slotX) < 30 && Math.abs(currentY - slotY) < 30) {
        const finalX = slotX - parseFloat(rect.getAttribute('x'));
        const finalY = slotY - parseFloat(rect.getAttribute('y'));
        selectedElement.setAttribute('transform', `translate(${finalX}, ${finalY})`);
        selectedElement.style.pointerEvents = 'none'; // Ya no se puede mover
        selectedElement.querySelector('.piece').style.stroke = "#fff";
        selectedElement.querySelector('.piece').style.strokeWidth = "4";
      }
      
      selectedElement = null;
    }
  });
</script>

</body>
</html>
